<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Playground</title>
    <link rel="stylesheet" href="../static/styles.css" />
    <!-- Include Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <!-- Include custom CSS -->
     <link rel="stylesheet" href="../static/styles.css" />
</head>
<body>
    <h1>GraphQL Playground</h1>

    <div class="container">
        <!-- Left Section: Form to Send Queries -->
        <div class="left-section">
            <h2>Send a Query/Mutation</h2>
            <div class="form-container">
                <form action="/run-query" method="POST" id="graphqlForm">
                    <label for="graphql_query">GraphQL Query/Mutation:</label>
                    <textarea id="graphql_query" name="graphql_query" rows="10" placeholder="Enter your query/mutation here"></textarea>

                    <label for="variables">Variables (JSON format):</label>
                    <textarea id="variables" name="variables" rows="5" placeholder='Enter variables here, e.g., {"id": "123"}'></textarea>

                    <button type="submit" onclick="saveLastQuery()">Send Query</button>
                </form>
            </div>
        </div>

        <!-- Middle Section: Display Results -->
        <div class="middle-section">
            <h2>Results</h2>
            <div class="result-view-options">
                <button onclick="showRawView()">Raw</button>
                <button onclick="showTreeView()">Tree</button>
                <button onclick="showObjectView()">Object</button>
            </div>

            <div id="result-view">
                {% if result %}
                <pre id="raw-result">{{ result|tojson(indent=2) }}</pre>
                <div id="tree-view" style="display: none;"></div>
                <div id="object-view" style="display: none;"></div>
                {% else %}
                <p>No results to display yet. Submit a query to see the results here.</p>
                {% endif %}
            </div>

            <!-- Loading Spinner -->
            <div class="loading-spinner" id="loadingSpinner">
                <img src="spinner.gif" alt="Loading...">
            </div>
        </div>

        <!-- Right Section: Queries/Mutations Dropdown -->
        <div class="right-section">
            <h2>Available Queries & Mutations</h2>

            <!-- Queries Section -->
            <div class="dropdown-section">
                <label for="queryDropdown">Queries:</label>
                <select id="queryDropdown" name="queryDropdown" onchange="updateQueryTextarea(this.value)">
                    <option value="">-- Select a Query --</option>
                    {% for query in queries %}
                    <option value="{{ query }}">{{ query }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Mutations Section -->
            <div class="dropdown-section">
                <label for="mutationDropdown">Mutations:</label>
                <select id="mutationDropdown" name="mutationDropdown" onchange="updateQueryTextarea(this.value)">
                    <option value="">-- Select a Mutation --</option>
                    {% for mutation in mutations %}
                    <option value="{{ mutation }}">{{ mutation }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <!-- JSON Viewer (JS) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jsonview/1.2.3/jquery.jsonview.min.js"></script>

    <script>
        function showRawView() {
            document.getElementById('raw-result').style.display = 'block';
            document.getElementById('tree-view').style.display = 'none';
            document.getElementById('object-view').style.display = 'none';
        }

        function showTreeView() {
            const jsonData = {{ result|tojson if result is defined else '{}' }};
            $('#tree-view').JSONView(jsonData, { collapsed: false });
            document.getElementById('tree-view').style.display = 'block';
            document.getElementById('raw-result').style.display = 'none';
            document.getElementById('object-view').style.display = 'none';
        }

        function showObjectView() {
            const jsonData = {{ result|tojson if result is defined else '{}' }};
            document.getElementById('object-view').innerHTML = '';
            const view = new JSONView(jsonData, { collapsed: true });
            document.getElementById('object-view').appendChild(view.dom);
            document.getElementById('object-view').style.display = 'block';
            document.getElementById('raw-result').style.display = 'none';
            document.getElementById('tree-view').style.display = 'none';
        }

        function updateQueryTextarea(selectedQuery) {
            document.getElementById('graphql_query').value = selectedQuery;
        }

        // Save the last query to localStorage
        function saveLastQuery() {
            const query = document.getElementById('graphql_query').value;
            const variables = document.getElementById('variables').value;
            localStorage.setItem('lastQuery', query);
            localStorage.setItem('lastVariables', variables);
        }

        // Retrieve the last query from localStorage
        document.addEventListener("DOMContentLoaded", function() {
            const lastQuery = localStorage.getItem('lastQuery');
            const lastVariables = localStorage.getItem('lastVariables');
            if (lastQuery) {
                document.getElementById('graphql_query').value = lastQuery;
            }
            if (lastVariables) {
                document.getElementById('variables').value = lastVariables;
            }
        });

       // Customization for JSONView
       $(document).ready(function() {
            // Apply styles to the expand/collapse buttons in Tree/Object view
            $(document).on('click', '.json-toggle', function() {
                $(this).toggleClass('plus minus');
            });
        });
    </script>
</body>
</html>
